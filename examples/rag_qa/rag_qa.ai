model "retriever":
  provider "openai_default"

ai is "rewrite_question":
  model "retriever"

ai is "compose_answer":
  model "retriever"

frame is "documents":
  source:
    backend is "memory"
    table is "documents"

vector_store is "kb":
  backend is "memory"
  frame is "documents"
  text_column is "content"
  id_column is "id"
  embedding_model is "default_embedding"
  metadata_columns are ["title"]

rag pipeline is "kb_qa":
  use vector_store "kb"
  stage is "rewrite":
    type is "ai_rewrite"
    ai is "rewrite_question"
  stage is "retrieve":
    type is "vector_retrieve"
    top_k is 3
  stage is "answer":
    type is "ai_answer"
    ai is "compose_answer"

flow is "ingest_documents":
  description "Seed a couple of docs and build the vector index."
  step is "insert_intro":
    kind is "frame_insert"
    frame is "documents"
    values:
      id: 1
      title: "What is Namel3ss?"
      content: "Namel3ss is an English-first programming language with AI, flows, and data features."
  step is "insert_frames":
    kind is "frame_insert"
    frame is "documents"
    values:
      id: 2
      title: "Frames and vector stores"
      content: "Frames load tabular data. Vector stores index a frame's text column for retrieval."
  step is "index":
    kind is "vector_index_frame"
    vector_store is "kb"

flow is "ask":
  description "Call the RAG pipeline to rewrite, retrieve, and answer."
  step is "answer":
    kind is "rag_query"
    pipeline is "kb_qa"
    question is state.question

app is "rag_qa_app":
  entry_page is "qa_home"
  description "RAG-style Q&A over a small built-in knowledge note."

page is "qa_home" at "/rag-qa":
  section "prompt":
    heading "RAG Q&A"
    text "Run ingest_documents once to build the index, then call ask with state.question set to your query."
