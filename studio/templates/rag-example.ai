model "retriever":
  provider "openai"

ai is "rewrite_query":
  model "retriever"
  input from "user_input"
  description "Rewrite the query to be concise and retrieval-friendly."

ai is "fetch_context":
  model "retriever"
  input from "user_input"
  description "Identify relevant snippets for the rewritten query."

ai is "compose_answer":
  model "retriever"
  input from "user_input"
  description "Compose a short answer based on retrieved snippets."

flow is "search_pipeline":
  description "Rewrite the query, retrieve context, and compose an answer."
  step "rewrite":
    kind "ai"
    target "rewrite_query"
  step "retrieve":
    kind "ai"
    target "fetch_context"
  step "answer":
    kind "ai"
    target "compose_answer"

app is "RAG Demo":
  entry_page "search"
  description "RAG-flavored pipeline answering questions over a small note."

page is "search":
  route "/rag"
  title "RAG Knowledge Search"
  section "query":
    component "text":
      value "Ask questions using search_pipeline to rewrite and answer."
